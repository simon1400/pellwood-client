{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useContext } from 'react';\nimport BlockContent from \"@sanity/block-content-to-react\";\nimport imageUrlBuilder from \"@sanity/image-url\";\nimport { dropdown, offcanvas } from 'uikit';\nimport Page from '../../layout/Page';\nimport RandomArticles from '../../components/RandomArticles';\nimport ShortBlock from '../../components/SmallShortCart';\nimport sanityClient from \"../../lib/sanity.js\";\nimport translate from '../../data/staticTranslate';\nimport { DataStateContext } from '../../context/dataStateContext';\nimport localize from '../../data/localize';\nimport { useRouter } from 'next/router';\nconst imageBuilder = imageUrlBuilder(sanityClient);\n\nconst urlFor = source => imageBuilder.image(source);\n\nexport async function getServerSideProps({\n  params,\n  locale\n}) {\n  const {\n    lang,\n    currency\n  } = localize(locale);\n  const query = `{\n    'products': *[_type == \"product\" && ${lang}.slug.current == $url] {\n      _id,\n      ${lang},\n      \"linkedCarts\": *[ _type == \"product\" && _id in [^.${lang}.linkedProducts.product_1._ref, ^.${lang}.linkedProducts.product_2._ref, ^.${lang}.linkedProducts.product_3._ref]].${lang} | order(sort asc)\n    },\n    'articles': *[_type == \"article\"] | order(sort asc)\n  }`;\n  const data = await sanityClient.fetch(query, {\n    url: params.product\n  });\n  var product = data.products[0][lang];\n\n  if (lang === 'en') {\n    var _product$variants;\n\n    if (typeof product.price === 'string') {\n      product.price.replace(/,/g, '.');\n    } else if ((_product$variants = product.variants) === null || _product$variants === void 0 ? void 0 : _product$variants.length) {\n      product.variants = product.variants.map(variant => {\n        variant.price = variant.price.replace(/,/g, '.');\n        return variant;\n      });\n    }\n  }\n\n  const filteredLinedcards = data.products[0].linkedCarts.filter(item => item === null || item === void 0 ? void 0 : item.title);\n\n  if (lang === 'en') {\n    filteredLinedcards.map(item => {\n      var _item$variants;\n\n      if (typeof item.price === 'string') {\n        item.price.replace(/,/g, '.');\n      } else if ((_item$variants = item.variants) === null || _item$variants === void 0 ? void 0 : _item$variants.length) {\n        item.variants = item.variants.map(variant => {\n          variant.price = variant.price.replace(/,/g, '.');\n          return variant;\n        });\n      }\n    });\n  }\n\n  const shuffle = (a, count) => {\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n\n    return a;\n  };\n\n  const articlesFilteredFirst = data.articles.filter(item => {\n    var _item$lang;\n\n    return (_item$lang = item[lang]) === null || _item$lang === void 0 ? void 0 : _item$lang.category._ref.includes(\"3252355e-13f2-4628-8db4-a90bb522713b\");\n  });\n  const articlesFilteredSeccond = data.articles.filter(item => {\n    var _item$lang2;\n\n    return (_item$lang2 = item[lang]) === null || _item$lang2 === void 0 ? void 0 : _item$lang2.category._ref.includes(\"53b17b89-299c-48b1-b332-26240fc0e624\");\n  });\n  return {\n    props: {\n      carts: filteredLinedcards,\n      articleFirst: shuffle(articlesFilteredFirst, 0),\n      articleSeccond: shuffle(articlesFilteredSeccond, 1),\n      product,\n      productId: data.products[0]._id,\n      lang,\n      currency\n    }\n  };\n}\n\nconst Product = ({\n  carts,\n  articleFirst,\n  articleSeccond,\n  product,\n  productId,\n  lang,\n  currency\n}) => {\n  var _product$variants5, _product$variants6, _product$variants7;\n\n  const router = useRouter();\n  const {\n    0: count,\n    1: setCount\n  } = useState(1);\n  const {\n    0: loader,\n    1: setLoader\n  } = useState(false);\n  const {\n    dataContextState,\n    dataContextDispatch\n  } = useContext(DataStateContext);\n  const {\n    0: select,\n    1: setSelect\n  } = useState({\n    name: translate.selectvariant[lang],\n    price: ''\n  });\n  const {\n    0: error,\n    1: setError\n  } = useState({\n    select: false,\n    count: false\n  });\n\n  const selectHandle = (name, price) => {\n    setSelect(_objectSpread(_objectSpread({}, select), {}, {\n      name,\n      price\n    }));\n    setError(_objectSpread(_objectSpread({}, error), {}, {\n      select: false\n    }));\n    dropdown(\".select-variant\").hide();\n  };\n\n  const onBuy = async () => {\n    var _product$variants2, _product$variants3;\n\n    setLoader(true);\n\n    if (select.name === translate.selectvariant[lang] && (product === null || product === void 0 ? void 0 : (_product$variants2 = product.variants) === null || _product$variants2 === void 0 ? void 0 : _product$variants2.length)) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        select: true\n      }));\n      setLoader(false);\n      router.push(router.asPath);\n      return;\n    }\n\n    if (count === 0) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        count: true\n      }));\n      setLoader(false);\n      router.push(router.asPath);\n      return;\n    }\n\n    router.push(router.asPath + '?buy=true');\n    var newBasketItem = {\n      id: productId,\n      nameProduct: product.title,\n      variantName: select.name,\n      variantPrice: select.price,\n      countVariant: count,\n      imgUrl: urlFor(product.image).url()\n    };\n\n    if (!(product === null || product === void 0 ? void 0 : (_product$variants3 = product.variants) === null || _product$variants3 === void 0 ? void 0 : _product$variants3.length)) {\n      newBasketItem.variantName = product.title;\n\n      if (typeof product.price === 'string') {\n        newBasketItem.variantPrice = product.price;\n      } else {\n        newBasketItem.variantPrice = product.price;\n      }\n    } else {\n      newBasketItem.variantName = select.name;\n      newBasketItem.variantPrice = select.price;\n    }\n\n    let basket = dataContextState.basket;\n    let basketCount = dataContextState.basketCount;\n\n    if (basket === undefined || basket === null || !basket) {\n      basket = [];\n      basket.push(newBasketItem);\n      basketCount = 1;\n    } else {\n      let indexBasket = -1;\n      basket.map((item, index) => {\n        var _product$variants4;\n\n        if (product === null || product === void 0 ? void 0 : (_product$variants4 = product.variants) === null || _product$variants4 === void 0 ? void 0 : _product$variants4.length) {\n          if (item.id === productId && basket[index].variantName === select.name) {\n            indexBasket = index;\n          }\n        } else if (item.id === productId) {\n          indexBasket = index;\n        }\n      });\n\n      if (indexBasket >= 0) {\n        basket[indexBasket].countVariant = +basket[indexBasket].countVariant + count;\n      } else {\n        basketCount = +basketCount + 1;\n        basket.push(newBasketItem);\n      }\n\n      indexBasket = -1;\n    }\n\n    dataContextDispatch({\n      state: basket,\n      type: 'basket'\n    });\n    dataContextDispatch({\n      state: basketCount,\n      type: 'basketCount'\n    });\n    await offcanvas('#offcanvas-flip').show();\n    setLoader(false);\n  };\n\n  return __jsx(Page, {\n    id: \"product\",\n    description: product.descriptionHead,\n    title: product.titleHead,\n    image: product.orientedImage ? urlFor(product.image).orientation(270).url() : urlFor(product.image).url()\n  }, __jsx(\"section\", {\n    className: \"full product\"\n  }, __jsx(\"div\", {\n    className: \"uk-grid uk-child-width-1-1 uk-child-width-1-2@m\",\n    \"uk-grid\": \"\",\n    \"uk-height-match\": \"target: > div > div\"\n  }, __jsx(\"div\", null, __jsx(\"div\", {\n    className: `article_img_wrap ${product.orientedImage && 'scale_img'}`\n  }, __jsx(\"div\", {\n    className: \"uk-visible@m\"\n  }, product.orientedImage ? __jsx(\"img\", {\n    src: urlFor(product.image).orientation(270).url(),\n    alt: product.title\n  }) : __jsx(\"img\", {\n    src: urlFor(product.image).url(),\n    alt: product.title\n  })), __jsx(\"div\", {\n    className: `uk-hidden@m ${product.orientedImage && 'orianted-img'}`\n  }, product.orientedImage ? __jsx(\"img\", {\n    src: urlFor(product.image).orientation(180).url(),\n    alt: product.title\n  }) : __jsx(\"img\", {\n    src: urlFor(product.image).url(),\n    alt: product.title\n  })))), __jsx(\"div\", null, __jsx(\"div\", {\n    className: \"content_wrap grey\"\n  }, __jsx(\"div\", {\n    className: \"content\"\n  }, __jsx(\"h1\", {\n    className: \"head_1\"\n  }, product.title), !!(product === null || product === void 0 ? void 0 : (_product$variants5 = product.variants) === null || _product$variants5 === void 0 ? void 0 : _product$variants5.length) && __jsx(\"div\", {\n    className: \"variants_list\"\n  }, product.variants.map((item, index) => {\n    if (item.price) {\n      return __jsx(\"div\", {\n        key: index,\n        className: \"uk-grid uk-grid-medium\",\n        \"uk-grid\": \"\"\n      }, __jsx(\"div\", {\n        className: \"uk-width-expand\"\n      }, item.title), __jsx(\"div\", {\n        className: \"short_price\"\n      }, lang === 'en' ? (Math.round(+item.price * 100) / 100).toFixed(2) : item.price, \" \", currency));\n    }\n\n    return '';\n  })), !!(product === null || product === void 0 ? void 0 : (_product$variants6 = product.variants) === null || _product$variants6 === void 0 ? void 0 : _product$variants6[0].price) && __jsx(\"div\", {\n    className: \"order_block\"\n  }, __jsx(\"div\", {\n    className: \"uk-flex uk-flex-between\"\n  }, __jsx(\"div\", {\n    className: \"uk-width-1-1 uk-width-auto@m\"\n  }, __jsx(\"div\", {\n    className: \"custom-select-wrap\"\n  }, __jsx(\"button\", {\n    className: `custom-select uk-button uk-button-default ${error.select && 'error'}`,\n    type: \"button\",\n    tabIndex: \"-1\"\n  }, __jsx(\"span\", null, select.name), __jsx(\"span\", null, __jsx(\"img\", {\n    src: \"/assets/chevron-down-light.svg\",\n    alt: \"Down\"\n  }))), __jsx(\"div\", {\n    className: \"uk-dropdown select-variant\",\n    \"uk-dropdown\": \"mode: click; pos: bottom-justify; offset: 0\"\n  }, __jsx(\"ul\", {\n    className: \"uk-nav uk-dropdown-nav\"\n  }, ((product === null || product === void 0 ? void 0 : product.variants) || []).map((item, index) => __jsx(Variant, {\n    key: index,\n    lang: lang,\n    currency: currency,\n    handle: selectHandle,\n    name: item.title,\n    price: item.price\n  })))))), __jsx(\"div\", {\n    className: `custom_number quantity ${error.count && 'error'}`\n  }, __jsx(\"input\", {\n    type: \"number\",\n    min: \"1\",\n    max: \"1000\",\n    step: \"1\",\n    onChange: e => setCount(+e.target.value),\n    value: count\n  }), __jsx(\"div\", {\n    className: \"quantity-nav\"\n  }, __jsx(\"div\", {\n    className: \"quantity-button quantity-up\",\n    onClick: () => setCount(count + 1)\n  }, \"+\"), __jsx(\"div\", {\n    className: \"quantity-button quantity-down\",\n    onClick: () => {\n      if (count > 0) {\n        return setCount(count - 1);\n      } else {\n        return false;\n      }\n    }\n  }, \"-\")))), __jsx(\"button\", {\n    className: \"uk-width-1-1 uk-margin-top tm-button tm-black-button\",\n    onClick: () => onBuy()\n  }, loader && __jsx(\"div\", {\n    \"uk-spinner\": \"\",\n    className: \"uk-icon uk-spinner\"\n  }), translate.addToBasket[lang])), !(product === null || product === void 0 ? void 0 : (_product$variants7 = product.variants) === null || _product$variants7 === void 0 ? void 0 : _product$variants7.length) && __jsx(\"div\", {\n    className: \"tm-single-order\"\n  }, __jsx(\"div\", {\n    className: \"tm-single-price uk-text-center uk-margin-bottom\"\n  }, currency === '$' && currency, \" \", product.price, \" \", currency !== '$' && currency), __jsx(\"div\", {\n    className: \"uk-grid-small uk-grid\",\n    \"uk-grid\": \"\"\n  }, __jsx(\"div\", {\n    className: \"uk-width-1-3\"\n  }, __jsx(\"div\", {\n    className: `custom_number quantity ${error.count && 'error'}`\n  }, __jsx(\"input\", {\n    type: \"number\",\n    min: \"1\",\n    max: \"1000\",\n    step: \"1\",\n    onChange: e => setCount(+e.target.value),\n    value: count\n  }), __jsx(\"div\", {\n    className: \"quantity-nav\"\n  }, __jsx(\"div\", {\n    className: \"quantity-button quantity-up\",\n    onClick: () => setCount(count + 1)\n  }, \"+\"), __jsx(\"div\", {\n    className: \"quantity-button quantity-down\",\n    onClick: () => {\n      if (count > 0) {\n        return setCount(count - 1);\n      } else {\n        return false;\n      }\n    }\n  }, \"-\")))), __jsx(\"div\", {\n    className: \"uk-width-2-3\"\n  }, __jsx(\"button\", {\n    className: \"uk-width-1-1 tm-button tm-black-button\",\n    onClick: () => onBuy()\n  }, loader && __jsx(\"div\", {\n    \"uk-spinner\": \"\",\n    className: \"uk-icon uk-spinner\"\n  }), translate.addToBasket[lang])))), __jsx(\"div\", {\n    className: \"description_product\"\n  }, __jsx(BlockContent, {\n    blocks: product.text\n  })), __jsx(\"div\", {\n    className: \"paramets\"\n  }, __jsx(\"table\", {\n    className: \"uk-table uk-table-divider uk-table-small\"\n  }, __jsx(\"tbody\", null, (product.parametrs || []).map((item, index) => __jsx(\"tr\", {\n    key: index\n  }, __jsx(\"td\", null, item.title), __jsx(\"td\", {\n    className: \"uk-text-right\"\n  }, item.value))))))))))), __jsx(ShortBlock, {\n    data: carts,\n    lang: lang,\n    currency: currency\n  }), __jsx(RandomArticles, {\n    lang: lang,\n    articleFirst: articleFirst,\n    articleSeccond: articleSeccond\n  }));\n};\n\nconst Variant = ({\n  handle,\n  name,\n  price,\n  lang,\n  currency\n}) => {\n  return __jsx(\"li\", {\n    className: \"variant_select uk-flex\",\n    onClick: e => handle(name, price)\n  }, __jsx(\"span\", {\n    className: \"uk-width-expand\"\n  }, name), __jsx(\"span\", {\n    className: \"uk-width-auto uk-text-right\"\n  }, lang === 'en' ? (Math.round(price * 100) / 100).toFixed(2) : price, \" \", currency));\n};\n\nexport default Product;","map":null,"metadata":{},"sourceType":"module"}