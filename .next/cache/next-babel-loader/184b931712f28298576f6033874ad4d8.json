{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport { modal, util } from 'uikit';\nimport Page from '../../layout/Page';\nimport RandomArticles from '../../components/RandomArticles';\nimport Cart from '../../components/Cart';\nimport SubMenu from '../../components/SubMenu';\nimport sanityClient from \"../../lib/sanity.js\";\nimport ModalFilter from '../../components/ModalFilter';\nimport translate from '../../data/staticTranslate';\nimport localize from '../../data/localize';\nexport async function getServerSideProps({\n  locale\n}) {\n  var _data$settings$filter;\n\n  const {\n    lang,\n    currency\n  } = localize(locale);\n  const query = `{\n    'product': *[_type == \"product\"].${lang} | order(${lang}.sort asc) | order(${lang}.title asc),\n    'category': *[_type == \"category\"] | order(${lang}.sort asc),\n    'articles': *[_type == \"article\"] | order(${lang}.sort asc),\n    'settings': *[_type == \"settings\"].${lang}\n  }`;\n  const data = await sanityClient.fetch(query);\n\n  const shuffle = (a, count) => {\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n\n    return a;\n  };\n\n  return {\n    props: {\n      category: data.category.filter(item => item === null || item === void 0 ? void 0 : item._id),\n      settings: (_data$settings$filter = data.settings.filter(item => item === null || item === void 0 ? void 0 : item.titleCategory)) === null || _data$settings$filter === void 0 ? void 0 : _data$settings$filter[0],\n      articleFirst: shuffle(data.articles.filter(item => {\n        var _item$lang;\n\n        return (_item$lang = item[lang]) === null || _item$lang === void 0 ? void 0 : _item$lang.category._ref.includes(\"3252355e-13f2-4628-8db4-a90bb522713b\");\n      }), 0),\n      articleSeccond: shuffle(data.articles.filter(item => {\n        var _item$lang2;\n\n        return (_item$lang2 = item[lang]) === null || _item$lang2 === void 0 ? void 0 : _item$lang2.category._ref.includes(\"53b17b89-299c-48b1-b332-26240fc0e624\");\n      }), 1),\n      lang,\n      currency\n    }\n  };\n}\n\nconst Catalog = ({\n  category,\n  settings,\n  articleFirst,\n  articleSeccond,\n  lang,\n  currency\n}) => {\n  var _settings$metaCatalog, _settings$metaCatalog2;\n\n  const {\n    0: product,\n    1: setProduct\n  } = useState([]);\n  const {\n    0: filtered,\n    1: setFiltered\n  } = useState(false);\n  const {\n    0: resetFilter\n  } = useState('');\n  const {\n    0: search,\n    1: setSearch\n  } = useState('');\n  const {\n    0: urlProduct,\n    1: setUrlProduct\n  } = useState(`*[_type == \"product\"].${lang}`);\n  const {\n    0: stateRange,\n    1: setStateRange\n  } = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  });\n  const {\n    0: rangeNumber,\n    1: setRangeNumber\n  } = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  });\n  useEffect(() => {\n    sanityClient.fetch(`${urlProduct} | order(sort asc, title asc)`).then(data => {\n      let filteredProduct = data.filter(item => item === null || item === void 0 ? void 0 : item.title);\n\n      if (lang === 'en') {\n        filteredProduct.map(item => {\n          var _item$variants;\n\n          if (typeof item.price === 'string') {\n            item.price.replace(/,/g, '.');\n          } else if ((_item$variants = item.variants) === null || _item$variants === void 0 ? void 0 : _item$variants.length) {\n            item.variants = item.variants.map(variant => {\n              variant.price = variant.price.replace(/,/g, '.');\n              return variant;\n            });\n          }\n        });\n      }\n\n      setProduct(filteredProduct);\n      const lengthNumbers = [],\n            diameterNumbers = [];\n      var length = undefined,\n          diameter = undefined;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i;\n\n        if ((_filteredProduct$i = filteredProduct[i]) === null || _filteredProduct$i === void 0 ? void 0 : _filteredProduct$i.parametrs) {\n          var _filteredProduct$i2, _filteredProduct$i3;\n\n          length = (_filteredProduct$i2 = filteredProduct[i]) === null || _filteredProduct$i2 === void 0 ? void 0 : _filteredProduct$i2.parametrs.find(o => o.title === 'Délka' || o.title === 'Length');\n          diameter = (_filteredProduct$i3 = filteredProduct[i]) === null || _filteredProduct$i3 === void 0 ? void 0 : _filteredProduct$i3.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter');\n\n          if (length) {\n            lengthNumbers.push(+length.value.substr(0, length.value.length - 3).split(',').join('.'));\n          }\n\n          if (diameter) {\n            diameterNumbers.push(+diameter.value.substr(0, diameter.value.length - 3).split(',').join('.'));\n          }\n        }\n      }\n\n      const rangeNum = {\n        length: {\n          min: Math.min(...lengthNumbers),\n          max: Math.max(...lengthNumbers)\n        },\n        diameter: {\n          min: Math.min(...diameterNumbers),\n          max: Math.max(...diameterNumbers)\n        }\n      };\n      setRangeNumber(rangeNum);\n      setStateRange(rangeNum);\n    });\n  }, []);\n\n  const closeModal = () => {\n    modal(util.find('#modal-filter')).hide();\n  };\n\n  const handleFilter = e => {\n    e.preventDefault();\n    const newUrlProduct = `*[_type == \"product\" ${!!search.length ? '&& ' + lang + '.title match \"' + search.split(/[,-]+/).join(' ') + '*\"' : ''}].${lang}`;\n    setUrlProduct(newUrlProduct);\n    const searchQuery = `${newUrlProduct} | order(sort asc, title asc)`;\n    sanityClient.fetch(searchQuery).then(data => {\n      const filteredProduct = data.filter(item => item === null || item === void 0 ? void 0 : item.title);\n      const filteredProdParameters = [];\n      var length = undefined,\n          diameter = undefined,\n          lengthNum = 0,\n          diameterNum = 0;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i4;\n\n        if ((_filteredProduct$i4 = filteredProduct[i]) === null || _filteredProduct$i4 === void 0 ? void 0 : _filteredProduct$i4.parametrs) {\n          var _filteredProduct$i5, _filteredProduct$i6;\n\n          length = (_filteredProduct$i5 = filteredProduct[i]) === null || _filteredProduct$i5 === void 0 ? void 0 : _filteredProduct$i5.parametrs.find(o => o.title === 'Délka' || o.title === 'Length');\n          diameter = (_filteredProduct$i6 = filteredProduct[i]) === null || _filteredProduct$i6 === void 0 ? void 0 : _filteredProduct$i6.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter');\n\n          if (length || diameter) {\n            if (length) {\n              lengthNum = +length.value.substr(0, length.value.length - 3).split(',').join('.');\n            }\n\n            if (diameter) {\n              diameterNum = +diameter.value.substr(0, diameter.value.length - 3).split(',').join('.');\n            }\n\n            if (lengthNum <= stateRange.length.max && lengthNum >= stateRange.length.min && diameterNum <= stateRange.diameter.max && diameterNum >= stateRange.diameter.min) {\n              filteredProdParameters.push(filteredProduct[i]);\n            }\n          }\n        }\n      }\n\n      setProduct(filteredProdParameters);\n    });\n    closeModal();\n    setFiltered(true);\n  };\n\n  const cancelFilter = async e => {\n    e.preventDefault();\n    setFiltered(false);\n    setStateRange(rangeNumber);\n    setSearch('');\n    setUrlProduct(`*[_type == \"product\"].${lang}`);\n    const data = await sanityClient.fetch(`*[_type == \"product\"].${lang} | order(sort asc) | order(title asc)`);\n    setProduct(data);\n  };\n\n  return __jsx(Page, {\n    id: \"catalog\",\n    title: (_settings$metaCatalog = settings.metaCatalog) === null || _settings$metaCatalog === void 0 ? void 0 : _settings$metaCatalog.title,\n    description: (_settings$metaCatalog2 = settings.metaCatalog) === null || _settings$metaCatalog2 === void 0 ? void 0 : _settings$metaCatalog2.description\n  }, (settings === null || settings === void 0 ? void 0 : settings.titleCategory) && __jsx(\"section\", {\n    className: \"head_category\"\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"div\", {\n    className: \"content_head_wrap\"\n  }, __jsx(\"h1\", null, settings.titleCategory), __jsx(\"p\", null, settings.descriptionCategory)))), __jsx(\"section\", {\n    className: \"category grey\",\n    id: \"catalog-short\",\n    \"uk-filter\": \"target: .js-filter\"\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"div\", {\n    className: \"category_menu uk-flex uk-flex-between uk-flex-middle uk-flex-wrap\"\n  }, __jsx(\"div\", {\n    className: \"uk-flex uk-flex-middle uk-width-1-1 uk-flex-between uk-flex-wrap\"\n  }, __jsx(\"div\", {\n    className: \"filter-controls-wrap\"\n  }, __jsx(\"a\", {\n    className: \"tm-button tm-black-button\",\n    href: \"#modal-filter\",\n    \"uk-toggle\": \"\"\n  }, translate.searchAndFilter[lang]), filtered && __jsx(\"button\", {\n    className: \"cancel-filtered tm-button tm-button-text\",\n    onClick: e => cancelFilter(e)\n  }, __jsx(\"img\", {\n    src: \"/assets/times.svg\",\n    alt: \"Cancel filter\",\n    \"uk-svg\": \"\"\n  }), \"Zru\\u0161it v\\u0161echny filtry\")), __jsx(SubMenu, {\n    data: category\n  })))), __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"ul\", {\n    className: `js-filter uk-grid uk-child-width-1-1 uk-child-width-1-3@m uk-child-width-1-2@s${resetFilter ? ' show-all' : ''}`,\n    \"uk-grid\": \"\"\n  }, !!product.length && product.map((item, index) => __jsx(Cart, {\n    item: item,\n    key: index,\n    lang: lang,\n    currency: currency\n  }))))), __jsx(RandomArticles, {\n    lang: lang,\n    articleFirst: articleFirst,\n    articleSeccond: articleSeccond\n  }), __jsx(ModalFilter, {\n    setSearch: setSearch,\n    search: search,\n    lang: lang,\n    closeModal: closeModal,\n    setStateRange: setStateRange,\n    handleFilter: handleFilter,\n    rangeNumber: rangeNumber,\n    stateRange: stateRange\n  }));\n};\n\nexport default Catalog;","map":null,"metadata":{},"sourceType":"module"}