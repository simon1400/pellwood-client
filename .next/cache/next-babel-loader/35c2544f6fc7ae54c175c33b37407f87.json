{"ast":null,"code":"import _regeneratorRuntime from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect, useContext } from 'react';\nimport { AxiosAPI } from '../../../restClient';\nimport { DataStateContext } from '../../../context/dataStateContext';\nimport translate from '../../../data/staticTranslate';\nimport Page from '../../../layout/Page';\nimport { useRouter } from 'next/router';\nimport Head from '../../../components/Head';\nimport Body from '../../../components/Body';\nimport Checkout from '../../../components/Checkout';\nimport Total from '../../../components/Total';\nimport TotalEnd from '../../../components/TotalEnd';\nimport AcceptInfo from '../../../components/AcceptInfo';\nimport ButtonsSubmit from '../../../components/ButtonsSubmit';\nimport validationForm from '../../../functions/validationForm';\nimport sumTotal from '../../../functions/sumTotal';\nimport localize from '../../../data/localize';\n\nvar Basket = function Basket() {\n  var router = useRouter();\n\n  var _localize = localize(router.locale),\n      lang = _localize.lang,\n      currency = _localize.currency;\n\n  var _useContext = useContext(DataStateContext),\n      dataContextState = _useContext.dataContextState,\n      dataContextDispatch = _useContext.dataContextDispatch;\n\n  var _useState = useState(0),\n      sum = _useState[0],\n      setSum = _useState[1];\n\n  var _useState2 = useState(0),\n      sumBefore = _useState2[0],\n      setSumBefore = _useState2[1];\n\n  var _useState3 = useState(0),\n      sale = _useState3[0],\n      setSale = _useState3[1];\n\n  var _useState4 = useState(dataContextState.basket),\n      basket = _useState4[0];\n\n  var _useState5 = useState(dataContextState.user),\n      user = _useState5[0],\n      setUser = _useState5[1];\n\n  var state = useState({\n    email: (user === null || user === void 0 ? void 0 : user.email) || '',\n    phone: (user === null || user === void 0 ? void 0 : user.phone) || '',\n    name: (user === null || user === void 0 ? void 0 : user.name) || '',\n    surname: (user === null || user === void 0 ? void 0 : user.surname) || '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: (user === null || user === void 0 ? void 0 : user.city) || '',\n    address: (user === null || user === void 0 ? void 0 : user.address) || '',\n    code: (user === null || user === void 0 ? void 0 : user.code) || '',\n    anotherAddressCheck: false,\n    companyDataCheck: false,\n    registrationCheck: false,\n    noteCheck: false\n  });\n  var anotherAdress = useState({\n    email: '',\n    phone: '',\n    name: '',\n    surname: '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: '',\n    address: '',\n    code: ''\n  });\n  var companyData = useState({\n    companyName: '',\n    ico: '',\n    dic: ''\n  });\n  var password = useState('');\n  var note = useState('');\n  var deliveryMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n  var paymentMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n\n  var _useState6 = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false,\n    delivery: false,\n    payment: false\n  }),\n      error = _useState6[0],\n      setError = _useState6[1];\n\n  var _useState7 = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false\n  }),\n      errorAnother = _useState7[0],\n      setErrorAnother = _useState7[1];\n\n  useEffect(function () {\n    setUser(dataContextState.user);\n    state[1](_objectSpread(_objectSpread({}, state[0]), dataContextState.user));\n  }, [dataContextState.user]);\n  useEffect(function () {\n    sumTotal(0, 0, basket, setSumBefore, setSale, setSum, lang);\n  }, []);\n  useEffect(function () {\n    sumTotal(deliveryMethod[0].price, paymentMethod[0].price, basket, setSumBefore, setSale, setSum, lang);\n  }, [deliveryMethod, paymentMethod]);\n\n  var onBlur = function onBlur(type) {\n    if (validationForm(type, state[0], error, setError)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  var sendOrder = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var dataOrder;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (state[0].address.length) {\n                _context.next = 5;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                address: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 5:\n              if (state[0].city.length) {\n                _context.next = 10;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                city: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 10:\n              if (state[0].surname.length) {\n                _context.next = 15;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                surname: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 15:\n              if (state[0].name.length) {\n                _context.next = 20;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                name: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 20:\n              if (state[0].phone.length) {\n                _context.next = 25;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                phone: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 25:\n              if (state[0].code.length) {\n                _context.next = 28;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                code: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 28:\n              if (!onBlur('email')) {\n                _context.next = 30;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 30:\n              if (deliveryMethod[0].value.length) {\n                _context.next = 33;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                delivery: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 33:\n              if (paymentMethod[0].value.length) {\n                _context.next = 36;\n                break;\n              }\n\n              setError(_objectSpread(_objectSpread({}, error), {}, {\n                payment: true\n              }));\n              return _context.abrupt(\"return\");\n\n            case 36:\n              if (basket.length) {\n                _context.next = 39;\n                break;\n              }\n\n              window.location.href = '/';\n              return _context.abrupt(\"return\");\n\n            case 39:\n              dataOrder = {\n                basket: basket,\n                sum: sum,\n                status: 'PENDING',\n                user: _objectSpread(_objectSpread({}, state[0]), {}, {\n                  anotherAdress: anotherAdress[0],\n                  companyData: companyData[0],\n                  password: password[0]\n                }),\n                delivery: deliveryMethod[0],\n                payment: paymentMethod[0],\n                note: note[0],\n                currency: currency\n              };\n\n              if (state[0].registrationCheck) {\n                AxiosAPI.post(\"\".concat(process.env.REACT_APP_API, \"/user\"), {\n                  data: dataOrder.user,\n                  type: 'create'\n                }).then(function (res) {\n                  return dataContextDispatch({\n                    state: res.data.data,\n                    type: 'user'\n                  });\n                });\n              }\n\n              _context.next = 43;\n              return AxiosAPI.post(\"\".concat(process.env.REACT_APP_API, \"/order\"), dataOrder).then(function (res) {\n                if (dataOrder.payment.payOnline) {\n                  window.location.href = decodeURIComponent(res.data.data.redirect);\n                } else {\n                  window.location.href = \"/thank-you?refId=\".concat(res.data.data.idOrder, \"&dobirka=true\");\n                }\n              });\n\n            case 43:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function sendOrder() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Page, {\n    className: \"basket\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content-wrap\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content\"\n  }, __jsx(Head, null), __jsx(Checkout, {\n    state: state,\n    error: error,\n    setError: setError,\n    user: user,\n    anotherAdress: anotherAdress,\n    companyData: companyData,\n    password: password,\n    note: note,\n    deliveryMethod: deliveryMethod,\n    errorAnother: errorAnother,\n    setErrorAnother: setErrorAnother,\n    paymentMethod: paymentMethod,\n    sumBefore: sumBefore,\n    onBlur: onBlur\n  }))), __jsx(\"div\", {\n    className: \"basket-right-panel\"\n  }, __jsx(\"div\", {\n    className: \"basket-right-content\"\n  }, __jsx(TotalEnd, {\n    sum: sum,\n    basket: basket,\n    sale: sale,\n    sumBefore: sumBefore,\n    delivery: deliveryMethod[0].price,\n    payment: paymentMethod[0].price\n  }), __jsx(\"div\", null, __jsx(\"p\", null, translate.infovat[lang]), __jsx(AcceptInfo, null)), __jsx(\"div\", {\n    className: \"tm-basket-footer tm-footer-single total-end-footer\"\n  }, Object.values(error).indexOf(true) >= 0 && __jsx(\"div\", {\n    className: \"uk-alert-danger uk-width-1-1 uk-text-center\",\n    \"uk-alert\": \"\"\n  }, __jsx(\"p\", null, translate.errorSendOrder[lang])), __jsx(ButtonsSubmit, {\n    sendOrder: sendOrder\n  })))));\n};\n\nexport default Basket;","map":null,"metadata":{},"sourceType":"module"}