{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useContext } from 'react';\nimport { modal } from 'uikit';\nimport translate from '../../data/staticTranslate';\nimport validationForm from '../../functions/validationForm';\nimport { DataStateContext } from '../../context/dataStateContext';\nimport { AxiosAPI } from '../../restClient';\nimport { useRouter } from 'next/router';\nimport localize from '../../data/localize';\n\nconst Login = ({\n  setLoginUser\n}) => {\n  const router = useRouter();\n  const {\n    lang\n  } = localize(router.locale);\n  const {\n    dataContextDispatch\n  } = useContext(DataStateContext);\n  const {\n    0: email,\n    1: setEmail\n  } = useState('');\n  const {\n    0: password,\n    1: setPassword\n  } = useState('');\n  const {\n    0: error,\n    1: setError\n  } = useState({\n    email: false,\n    password: false\n  });\n\n  const closeModal = () => {\n    modal('#modal-login').hide();\n  };\n\n  const handleInput = (e, type) => {\n    if (type === 'email') {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        email: false\n      }));\n      setEmail(e.target.value);\n    } else if (type === 'password') {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        password: false\n      }));\n      setPassword(e.target.value);\n    }\n  };\n\n  const onBlur = type => {\n    if (validationForm('email', {\n      email\n    }, error, setError)) {\n      return true;\n    }\n\n    if (type === 'password' && password.length < 8 && password.length > 0) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        password: true\n      }));\n      return true;\n    }\n\n    return false;\n  };\n\n  const forgotPassword = e => {\n    e.preventDefault();\n    modal('#modal-login').hide();\n    modal('#forgot-password').show();\n  };\n\n  const onLogin = e => {\n    e.preventDefault();\n\n    if (onBlur('email') || onBlur('password')) {\n      return;\n    }\n\n    AxiosAPI.post(`/user/login`, {\n      email,\n      password\n    }).then(res => {\n      dataContextDispatch({\n        state: res.data.data,\n        type: 'user'\n      });\n      setLoginUser(true);\n      modal('#modal-login').hide();\n    }).catch(err => {\n      console.log(err.response);\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        email: 'notExist'\n      }));\n    });\n  };\n\n  const onRegister = e => {\n    e.preventDefault();\n\n    if (onBlur('email') || onBlur('password')) {\n      return;\n    }\n\n    AxiosAPI.post(`/user`, {\n      email,\n      password\n    }).then(res => {\n      var _res$data, _res$data$error, _res$data2, _res$data2$error;\n\n      if (res.data.error === 'email') setError(_objectSpread(_objectSpread({}, error), {}, {\n        email: 'exist'\n      }));else if (((_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$error = _res$data.error) === null || _res$data$error === void 0 ? void 0 : _res$data$error.indexOf('password')) >= 0) setError(_objectSpread(_objectSpread({}, error), {}, {\n        password: 'empty'\n      }));else if (((_res$data2 = res.data) === null || _res$data2 === void 0 ? void 0 : (_res$data2$error = _res$data2.error) === null || _res$data2$error === void 0 ? void 0 : _res$data2$error.indexOf('email')) >= 0) setError(_objectSpread(_objectSpread({}, error), {}, {\n        email: 'empty'\n      }));else {\n        // AxiosAPI.post(`${process.env.REACT_APP_API}/sendRegistration`, {email: res.data.data.email}).then(res => console.log('send mail'))\n        dataContextDispatch({\n          state: res.data.data,\n          type: 'user'\n        });\n        setLoginUser(true);\n        router.push(\"/user\");\n      }\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  return __jsx(\"div\", {\n    id: \"modal-login\",\n    className: \"uk-flex-top\",\n    \"uk-modal\": \"\"\n  }, __jsx(\"div\", {\n    className: \"uk-modal-dialog uk-modal-body uk-margin-auto-vertical\"\n  }, __jsx(\"div\", {\n    className: \"tm-canvas-head\"\n  }, __jsx(\"h2\", null, translate.login[lang]), __jsx(\"button\", {\n    className: \"tm-canvas-close uk-close-large\",\n    type: \"button\",\n    \"uk-close\": \"\",\n    onClick: e => closeModal()\n  })), __jsx(\"div\", {\n    className: \"login_form\"\n  }, __jsx(\"form\", {\n    onSubmit: e => onLogin(e)\n  }, error.email === 'notExist' && __jsx(\"div\", {\n    className: \"uk-alert-danger\",\n    \"uk-alert\": \"\"\n  }, __jsx(\"p\", null, translate.loginErrorWrong[lang])), error.email === 'exist' && __jsx(\"div\", {\n    className: \"uk-alert-danger\",\n    \"uk-alert\": \"\"\n  }, __jsx(\"p\", null, translate.loginErrorExist[lang])), (error.email === 'empty' || error.password === 'empty') && __jsx(\"div\", {\n    className: \"uk-alert-danger\",\n    \"uk-alert\": \"\"\n  }, __jsx(\"p\", null, translate.emptyFields[lang])), __jsx(\"div\", {\n    className: \"uk-margin input_item\"\n  }, __jsx(\"input\", {\n    className: `${email.length && 'hasValue'} ${!!error.email && 'invalid'}`,\n    type: \"email\",\n    value: email,\n    onBlur: () => onBlur('email'),\n    onChange: e => handleInput(e, 'email'),\n    tabIndex: \"1\"\n  }), __jsx(\"label\", null, translate.formemail[lang])), __jsx(\"div\", {\n    className: \"uk-margin input_item\"\n  }, __jsx(\"input\", {\n    className: `${password.length && 'hasValue'} ${(error.password || error.email === 'notExist') && 'invalid'}`,\n    type: \"password\",\n    onBlur: () => onBlur('password'),\n    value: password,\n    onChange: e => handleInput(e, 'password'),\n    tabIndex: \"2\"\n  }), __jsx(\"label\", null, translate.formpassword[lang])), __jsx(\"button\", {\n    type: \"submit\",\n    className: \"tm-button tm-black-button uk-width-1-1\"\n  }, translate.login[lang]), __jsx(\"a\", {\n    href: \"/\",\n    onClick: e => forgotPassword(e),\n    className: \"tm-button tm-bare-button tm-button-text uk-width-1-1\"\n  }, __jsx(\"span\", null, translate.forgottenpassword[lang])), __jsx(\"hr\", null), __jsx(\"p\", null, translate.notyetaccount[lang]), __jsx(\"button\", {\n    className: \"tm-button tm-bare-button uk-width-1-1\",\n    onClick: e => onRegister(e)\n  }, __jsx(\"span\", null, translate.registration[lang]))))));\n};\n\nexport default Login;","map":null,"metadata":{},"sourceType":"module"}