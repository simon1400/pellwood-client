{"ast":null,"code":"var _jsxFileName = \"/Users/dmytropechunka/Desktop/work/pellwood/client/pages/produkty/index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport { modal, util } from 'uikit';\nimport Page from '../../layout/Page';\nimport RandomArticles from '../../components/RandomArticles';\nimport Cart from '../../components/Cart';\nimport SubMenu from '../../components/SubMenu';\nimport sanityClient from \"../../lib/sanity.js\";\nimport ModalFilter from '../../components/ModalFilter';\nimport translate from '../../data/staticTranslate';\nimport localize from '../../data/localize';\nexport async function getServerSideProps({\n  locale\n}) {\n  var _data$settings$filter;\n\n  const {\n    lang,\n    currency\n  } = localize(locale);\n  const query = `{\n    'product': *[_type == \"product\"].${lang} | order(${lang}.sort asc) | order(${lang}.title asc),\n    'category': *[_type == \"category\"] | order(${lang}.sort asc),\n    'articles': *[_type == \"article\"] | order(${lang}.sort asc),\n    'settings': *[_type == \"settings\"].${lang}\n  }`;\n  const data = await sanityClient.fetch(query);\n\n  const shuffle = (a, count) => {\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n\n    return a;\n  };\n\n  return {\n    props: {\n      category: data.category.filter(item => item === null || item === void 0 ? void 0 : item._id),\n      settings: (_data$settings$filter = data.settings.filter(item => item === null || item === void 0 ? void 0 : item.titleCategory)) === null || _data$settings$filter === void 0 ? void 0 : _data$settings$filter[0],\n      articleFirst: shuffle(data.articles.filter(item => {\n        var _item$lang;\n\n        return (_item$lang = item[lang]) === null || _item$lang === void 0 ? void 0 : _item$lang.category._ref.includes(\"3252355e-13f2-4628-8db4-a90bb522713b\");\n      }), 0),\n      articleSeccond: shuffle(data.articles.filter(item => {\n        var _item$lang2;\n\n        return (_item$lang2 = item[lang]) === null || _item$lang2 === void 0 ? void 0 : _item$lang2.category._ref.includes(\"53b17b89-299c-48b1-b332-26240fc0e624\");\n      }), 1),\n      lang,\n      currency\n    }\n  };\n}\n\nconst Catalog = ({\n  category,\n  settings,\n  articleFirst,\n  articleSeccond,\n  lang,\n  currency\n}) => {\n  var _settings$metaCatalog, _settings$metaCatalog2;\n\n  const {\n    0: product,\n    1: setProduct\n  } = useState([]);\n  const {\n    0: filtered,\n    1: setFiltered\n  } = useState(false);\n  const {\n    0: resetFilter\n  } = useState('');\n  const {\n    0: search,\n    1: setSearch\n  } = useState('');\n  const {\n    0: urlProduct,\n    1: setUrlProduct\n  } = useState(`*[_type == \"product\"].${lang}`);\n  const {\n    0: stateRange,\n    1: setStateRange\n  } = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  });\n  const {\n    0: rangeNumber,\n    1: setRangeNumber\n  } = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  });\n  useEffect(() => {\n    sanityClient.fetch(`${urlProduct} | order(sort asc, title asc)`).then(data => {\n      let filteredProduct = data.filter(item => item === null || item === void 0 ? void 0 : item.title);\n\n      if (lang === 'en') {\n        filteredProduct.map(item => {\n          var _item$variants;\n\n          if (typeof item.price === 'string') {\n            item.price.replace(/,/g, '.');\n          } else if ((_item$variants = item.variants) === null || _item$variants === void 0 ? void 0 : _item$variants.length) {\n            item.variants = item.variants.map(variant => {\n              variant.price = variant.price.replace(/,/g, '.');\n              return variant;\n            });\n          }\n        });\n      }\n\n      setProduct(filteredProduct);\n      const lengthNumbers = [],\n            diameterNumbers = [];\n      var length = undefined,\n          diameter = undefined;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i;\n\n        if ((_filteredProduct$i = filteredProduct[i]) === null || _filteredProduct$i === void 0 ? void 0 : _filteredProduct$i.parametrs) {\n          var _filteredProduct$i2, _filteredProduct$i3;\n\n          length = (_filteredProduct$i2 = filteredProduct[i]) === null || _filteredProduct$i2 === void 0 ? void 0 : _filteredProduct$i2.parametrs.find(o => o.title === 'Délka' || o.title === 'Length');\n          diameter = (_filteredProduct$i3 = filteredProduct[i]) === null || _filteredProduct$i3 === void 0 ? void 0 : _filteredProduct$i3.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter');\n\n          if (length) {\n            lengthNumbers.push(+length.value.substr(0, length.value.length - 3).split(',').join('.'));\n          }\n\n          if (diameter) {\n            diameterNumbers.push(+diameter.value.substr(0, diameter.value.length - 3).split(',').join('.'));\n          }\n        }\n      }\n\n      const rangeNum = {\n        length: {\n          min: Math.min(...lengthNumbers),\n          max: Math.max(...lengthNumbers)\n        },\n        diameter: {\n          min: Math.min(...diameterNumbers),\n          max: Math.max(...diameterNumbers)\n        }\n      };\n      setRangeNumber(rangeNum);\n      setStateRange(rangeNum);\n    });\n  }, []);\n\n  const closeModal = () => {\n    modal(util.find('#modal-filter')).hide();\n  };\n\n  const handleFilter = e => {\n    e.preventDefault();\n    const newUrlProduct = `*[_type == \"product\" ${!!search.length ? '&& ' + lang + '.title match \"' + search.split(/[,-]+/).join(' ') + '*\"' : ''}].${lang}`;\n    setUrlProduct(newUrlProduct);\n    const searchQuery = `${newUrlProduct} | order(sort asc, title asc)`;\n    sanityClient.fetch(searchQuery).then(data => {\n      const filteredProduct = data.filter(item => item === null || item === void 0 ? void 0 : item.title);\n      const filteredProdParameters = [];\n      var length = undefined,\n          diameter = undefined,\n          lengthNum = 0,\n          diameterNum = 0;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i4;\n\n        if ((_filteredProduct$i4 = filteredProduct[i]) === null || _filteredProduct$i4 === void 0 ? void 0 : _filteredProduct$i4.parametrs) {\n          var _filteredProduct$i5, _filteredProduct$i6;\n\n          length = (_filteredProduct$i5 = filteredProduct[i]) === null || _filteredProduct$i5 === void 0 ? void 0 : _filteredProduct$i5.parametrs.find(o => o.title === 'Délka' || o.title === 'Length');\n          diameter = (_filteredProduct$i6 = filteredProduct[i]) === null || _filteredProduct$i6 === void 0 ? void 0 : _filteredProduct$i6.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter');\n\n          if (length || diameter) {\n            if (length) {\n              lengthNum = +length.value.substr(0, length.value.length - 3).split(',').join('.');\n            }\n\n            if (diameter) {\n              diameterNum = +diameter.value.substr(0, diameter.value.length - 3).split(',').join('.');\n            }\n\n            if (lengthNum <= stateRange.length.max && lengthNum >= stateRange.length.min && diameterNum <= stateRange.diameter.max && diameterNum >= stateRange.diameter.min) {\n              filteredProdParameters.push(filteredProduct[i]);\n            }\n          }\n        }\n      }\n\n      setProduct(filteredProdParameters);\n    });\n    closeModal();\n    setFiltered(true);\n  };\n\n  const cancelFilter = async e => {\n    e.preventDefault();\n    setFiltered(false);\n    setStateRange(rangeNumber);\n    setSearch('');\n    setUrlProduct(`*[_type == \"product\"].${lang}`);\n    const data = await sanityClient.fetch(`*[_type == \"product\"].${lang} | order(sort asc) | order(title asc)`);\n    setProduct(data);\n  };\n\n  return __jsx(Page, {\n    id: \"catalog\",\n    title: (_settings$metaCatalog = settings.metaCatalog) === null || _settings$metaCatalog === void 0 ? void 0 : _settings$metaCatalog.title,\n    description: (_settings$metaCatalog2 = settings.metaCatalog) === null || _settings$metaCatalog2 === void 0 ? void 0 : _settings$metaCatalog2.description,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 187,\n      columnNumber: 5\n    }\n  }, (settings === null || settings === void 0 ? void 0 : settings.titleCategory) && __jsx(\"section\", {\n    className: \"head_category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 35\n    }\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 189,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"content_head_wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 190,\n      columnNumber: 11\n    }\n  }, __jsx(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 13\n    }\n  }, settings.titleCategory), __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 13\n    }\n  }, settings.descriptionCategory)))), __jsx(\"section\", {\n    className: \"category grey\",\n    id: \"catalog-short\",\n    \"uk-filter\": \"target: .js-filter\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"category_menu uk-flex uk-flex-between uk-flex-middle uk-flex-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 11\n    }\n  }, __jsx(\"div\", {\n    className: \"uk-flex uk-flex-middle uk-width-1-1 uk-flex-between uk-flex-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 201,\n      columnNumber: 13\n    }\n  }, __jsx(\"div\", {\n    className: \"filter-controls-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 15\n    }\n  }, __jsx(\"a\", {\n    className: \"tm-button tm-black-button\",\n    href: \"#modal-filter\",\n    \"uk-toggle\": \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 17\n    }\n  }, translate.searchAndFilter[lang]), filtered && __jsx(\"button\", {\n    className: \"cancel-filtered tm-button tm-button-text\",\n    onClick: e => cancelFilter(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 30\n    }\n  }, __jsx(\"img\", {\n    src: \"/assets/times.svg\",\n    alt: \"Cancel filter\",\n    \"uk-svg\": \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 19\n    }\n  }), \"Zru\\u0161it v\\u0161echny filtry\")), __jsx(SubMenu, {\n    data: category,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 15\n    }\n  })))), __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, __jsx(\"ul\", {\n    className: `js-filter uk-grid uk-child-width-1-1 uk-child-width-1-3@m uk-child-width-1-2@s${resetFilter ? ' show-all' : ''}`,\n    \"uk-grid\": \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 11\n    }\n  }, !!product.length && product.map((item, index) => __jsx(Cart, {\n    item: item,\n    key: index,\n    lang: lang,\n    currency: currency,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 63\n    }\n  }))))), __jsx(RandomArticles, {\n    lang: lang,\n    articleFirst: articleFirst,\n    articleSeccond: articleSeccond,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 220,\n      columnNumber: 7\n    }\n  }), __jsx(ModalFilter, {\n    setSearch: setSearch,\n    search: search,\n    lang: lang,\n    closeModal: closeModal,\n    setStateRange: setStateRange,\n    handleFilter: handleFilter,\n    rangeNumber: rangeNumber,\n    stateRange: stateRange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }\n  }));\n};\n\nexport default Catalog;","map":{"version":3,"sources":["/Users/dmytropechunka/Desktop/work/pellwood/client/pages/produkty/index.js"],"names":["useState","useEffect","modal","util","Page","RandomArticles","Cart","SubMenu","sanityClient","ModalFilter","translate","localize","getServerSideProps","locale","lang","currency","query","data","fetch","shuffle","a","count","i","length","j","Math","floor","random","props","category","filter","item","_id","settings","titleCategory","articleFirst","articles","_ref","includes","articleSeccond","Catalog","product","setProduct","filtered","setFiltered","resetFilter","search","setSearch","urlProduct","setUrlProduct","stateRange","setStateRange","min","max","diameter","rangeNumber","setRangeNumber","then","filteredProduct","title","map","price","replace","variants","variant","lengthNumbers","diameterNumbers","undefined","parametrs","find","o","push","value","substr","split","join","rangeNum","closeModal","hide","handleFilter","e","preventDefault","newUrlProduct","searchQuery","filteredProdParameters","lengthNum","diameterNum","cancelFilter","metaCatalog","description","descriptionCategory","searchAndFilter","index"],"mappings":"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","sourcesContent":["import {useState, useEffect} from 'react';\nimport {modal, util} from 'uikit'\nimport Page from '../../layout/Page';\nimport RandomArticles from '../../components/RandomArticles';\nimport Cart from '../../components/Cart';\nimport SubMenu from '../../components/SubMenu';\nimport sanityClient from \"../../lib/sanity.js\";\nimport ModalFilter from '../../components/ModalFilter'\nimport translate from '../../data/staticTranslate'\nimport localize from '../../data/localize'\n\nexport async function getServerSideProps({locale}) {\n  const {lang, currency} = localize(locale)\n\n  const query = `{\n    'product': *[_type == \"product\"].${lang} | order(${lang}.sort asc) | order(${lang}.title asc),\n    'category': *[_type == \"category\"] | order(${lang}.sort asc),\n    'articles': *[_type == \"article\"] | order(${lang}.sort asc),\n    'settings': *[_type == \"settings\"].${lang}\n  }`;\n\n  const data = await sanityClient.fetch(query)\n\n  const shuffle = (a, count) => {\n    for (let i = a.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [a[i], a[j]] = [a[j], a[i]];\n    }\n    return a\n  }\n\n  return {\n    props: {\n      category: data.category.filter(item => item?._id),\n      settings: data.settings.filter(item => item?.titleCategory)?.[0],\n      articleFirst: shuffle(data.articles.filter(item => item[lang]?.category._ref.includes(\"3252355e-13f2-4628-8db4-a90bb522713b\")), 0),\n      articleSeccond: shuffle(data.articles.filter(item => item[lang]?.category._ref.includes(\"53b17b89-299c-48b1-b332-26240fc0e624\")), 1),\n      lang,\n      currency\n    }\n  }\n}\n\nconst Catalog = ({\n  category,\n  settings,\n  articleFirst,\n  articleSeccond,\n  lang,\n  currency\n}) => {\n\n  const [product, setProduct] = useState([])\n  const [filtered, setFiltered] = useState(false)\n  const [resetFilter] = useState('')\n  const [search, setSearch] = useState('')\n  const [urlProduct, setUrlProduct] = useState(`*[_type == \"product\"].${lang}`)\n\n  const [stateRange, setStateRange] = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  })\n\n  const [rangeNumber, setRangeNumber] = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  })\n\n  useEffect(() => {\n    sanityClient.fetch(`${urlProduct} | order(sort asc, title asc)`).then(data => {\n\n      let filteredProduct = data.filter(item => item?.title)\n      if(lang === 'en'){\n        filteredProduct.map(item => {\n          if(typeof item.price === 'string'){\n            item.price.replace(/,/g, '.')\n          }else if(item.variants?.length){\n            item.variants = item.variants.map(variant => {\n              variant.price = variant.price.replace(/,/g, '.')\n              return variant\n            })\n          }\n        })\n      }\n\n      setProduct(filteredProduct)\n\n      const lengthNumbers = [], diameterNumbers = []\n      var length = undefined, diameter = undefined;\n\n      for(var i = 0; i < filteredProduct.length; i++){\n        if(filteredProduct[i]?.parametrs){\n          length = filteredProduct[i]?.parametrs.find(o => o.title === 'Délka' || o.title === 'Length')\n          diameter = filteredProduct[i]?.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter')\n          if(length){\n            lengthNumbers.push(+length.value.substr(0, length.value.length - 3).split(',').join('.'))\n          }\n          if(diameter){\n            diameterNumbers.push(+diameter.value.substr(0, diameter.value.length - 3).split(',').join('.'))\n          }\n        }\n      }\n      const rangeNum = {\n        length: {\n          min: Math.min(...lengthNumbers),\n          max: Math.max(...lengthNumbers)\n        },\n        diameter: {\n          min: Math.min(...diameterNumbers),\n          max: Math.max(...diameterNumbers)\n        }\n      }\n\n      setRangeNumber(rangeNum)\n      setStateRange(rangeNum)\n    })\n  }, [])\n\n\n\n  const closeModal = () => {\n    modal(util.find('#modal-filter')).hide();\n  }\n\n  const handleFilter = (e) => {\n    e.preventDefault()\n\n    const newUrlProduct = `*[_type == \"product\" ${!!search.length ? '&& '+lang+'.title match \"'+ search.split(/[,-]+/).join(' ') +'*\"' : ''}].${lang}`\n    setUrlProduct(newUrlProduct)\n    const searchQuery = `${newUrlProduct} | order(sort asc, title asc)`\n    sanityClient.fetch(searchQuery).then(data => {\n      const filteredProduct = data.filter(item => item?.title)\n      const filteredProdParameters = []\n      var length = undefined, diameter = undefined, lengthNum = 0, diameterNum = 0;\n\n      for(var i = 0; i < filteredProduct.length; i++){\n        if(filteredProduct[i]?.parametrs){\n          length = filteredProduct[i]?.parametrs.find(o => o.title === 'Délka' || o.title === 'Length')\n          diameter = filteredProduct[i]?.parametrs.find(o => o.title === 'Průměr' || o.title === 'Diameter')\n\n          if(length || diameter){\n            if(length){\n              lengthNum = +length.value.substr(0, length.value.length - 3).split(',').join('.')\n            }\n            if(diameter){\n              diameterNum = +diameter.value.substr(0, diameter.value.length - 3).split(',').join('.')\n            }\n            if(lengthNum <= stateRange.length.max\n              && lengthNum >= stateRange.length.min\n              && diameterNum <= stateRange.diameter.max\n              && diameterNum >= stateRange.diameter.min){\n                filteredProdParameters.push(filteredProduct[i])\n            }\n          }\n        }\n      }\n      setProduct(filteredProdParameters)\n    })\n    closeModal()\n    setFiltered(true)\n  }\n\n\n  const cancelFilter = async (e) => {\n    e.preventDefault()\n    setFiltered(false)\n    setStateRange(rangeNumber)\n    setSearch('')\n    setUrlProduct(`*[_type == \"product\"].${lang}`)\n    const data = await sanityClient.fetch(`*[_type == \"product\"].${lang} | order(sort asc) | order(title asc)`)\n    setProduct(data)\n  }\n\n  return (\n    <Page id=\"catalog\" title={settings.metaCatalog?.title} description={settings.metaCatalog?.description}>\n      {settings?.titleCategory && <section className=\"head_category\">\n        <div className=\"uk-container uk-container-expand\">\n          <div className=\"content_head_wrap\">\n            <h1>{settings.titleCategory}</h1>\n            <p>{settings.descriptionCategory}</p>\n          </div>\n        </div>\n      </section>}\n\n\n      <section className=\"category grey\" id=\"catalog-short\" uk-filter=\"target: .js-filter\">\n        <div className=\"uk-container uk-container-expand\">\n          <div className=\"category_menu uk-flex uk-flex-between uk-flex-middle uk-flex-wrap\">\n            <div className=\"uk-flex uk-flex-middle uk-width-1-1 uk-flex-between uk-flex-wrap\">\n              <div className=\"filter-controls-wrap\">\n                <a className=\"tm-button tm-black-button\" href=\"#modal-filter\" uk-toggle=\"\">{translate.searchAndFilter[lang]}</a>\n                {filtered && <button className=\"cancel-filtered tm-button tm-button-text\" onClick={e => cancelFilter(e)}>\n                  <img src=\"/assets/times.svg\" alt=\"Cancel filter\" uk-svg=\"\" />\n                  Zrušit všechny filtry\n                </button>}\n              </div>\n              <SubMenu data={category}/>\n            </div>\n          </div>\n        </div>\n        <div className=\"uk-container uk-container-expand\">\n          <ul className={`js-filter uk-grid uk-child-width-1-1 uk-child-width-1-3@m uk-child-width-1-2@s${resetFilter ? ' show-all' : ''}`} uk-grid=\"\">\n            {!!product.length && product.map((item, index) => <Cart item={item} key={index} lang={lang} currency={currency} />)}\n          </ul>\n        </div>\n      </section>\n\n      <RandomArticles lang={lang} articleFirst={articleFirst} articleSeccond={articleSeccond}/>\n\n      <ModalFilter\n        setSearch={setSearch}\n        search={search}\n        lang={lang}\n        closeModal={closeModal}\n        setStateRange={setStateRange}\n        handleFilter={handleFilter}\n        rangeNumber={rangeNumber}\n        stateRange={stateRange} />\n\n    </Page>\n  )\n}\n\nexport default Catalog\n"]},"metadata":{},"sourceType":"module"}