{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useEffect, useContext } from 'react';\nimport AnimateHeight from 'react-animate-height';\nimport Delivery from '../../components/user/delivery.js';\nimport Corporate from '../../components/user/corporate.js';\nimport { DataStateContext } from '../../context/dataStateContext';\nimport { AxiosAPI } from '../../restClient';\nimport translate from '../../data/staticTranslate';\nimport validationForm from '../../functions/validationForm';\nimport localize from '../../data/localize';\nconst {\n  lang,\n  currency\n} = localize(window.location.href);\n\nconst User = () => {\n  const {\n    dataContextState,\n    dataContextDispatch\n  } = useContext(DataStateContext);\n  const {\n    0: user\n  } = useState(dataContextState.user);\n  const {\n    0: orders,\n    1: setOrders\n  } = useState([]);\n  const state = useState({\n    email: user.email,\n    phone: user.phone,\n    name: user.name,\n    surname: user.surname,\n    country: user.country,\n    city: user.city,\n    address: user.address,\n    code: user.code,\n    anotherAddressCheck: false,\n    companyDataCheck: false\n  });\n  const {\n    0: error,\n    1: setError\n  } = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false\n  });\n  const anotherAdress = useState(_objectSpread({}, user.anotherAdress));\n  const companyData = useState(_objectSpread({}, user.companyData));\n  useEffect(() => {\n    AxiosAPI.get(`${process.env.REACT_APP_API}/order/${state[0].email}`).then(res => {\n      setOrders(res.data.data);\n    });\n  }, []);\n\n  const handleChange = (name, value) => {\n    let newState = state[0];\n    newState[name] = value;\n    state[1](_objectSpread({}, newState));\n  };\n\n  const onSave = async e => {\n    if (!state[0].address.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        address: true\n      }));\n      return;\n    } else if (!state[0].city.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        city: true\n      }));\n      return;\n    } else if (!state[0].surname.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        surname: true\n      }));\n      return;\n    } else if (!state[0].name.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        name: true\n      }));\n      return;\n    } else if (!state[0].phone.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        phone: true\n      }));\n      return;\n    } else if (!state[0].code.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        code: true\n      }));\n      return;\n    }\n\n    if (onBlur('email')) return;\n\n    let saveData = _objectSpread(_objectSpread({\n      id: user._id\n    }, state[0]), {}, {\n      anotherAdress: anotherAdress[0],\n      companyData: companyData[0]\n    });\n\n    await AxiosAPI.put(`${process.env.REACT_APP_API}/user`, {\n      data: saveData,\n      type: 'update'\n    }).then(res => {\n      dataContextDispatch({\n        state: res.data.data,\n        type: 'user'\n      });\n    }).catch(err => {\n      console.log(err);\n    });\n  };\n\n  const onLogout = () => {\n    dataContextDispatch({\n      state: null,\n      type: 'user'\n    });\n    localStorage.removeItem('user');\n    window.location.href = `/${lang === 'en' ? 'en' : ''}`;\n  };\n\n  const onBlur = type => {\n    if (validationForm(type, state[0], error, setError)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  return __jsx(\"main\", {\n    className: \"basket user\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content-wrap\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-head\"\n  }, __jsx(\"h1\", null, translate.yourAccount[lang])), __jsx(Delivery, {\n    state: state[0],\n    setState: state[1],\n    error: error,\n    setError: setError,\n    onBlur: onBlur\n  }), __jsx(\"div\", {\n    className: \"uk-margin-small checkbox_item\"\n  }, __jsx(\"input\", {\n    type: \"checkbox\",\n    id: \"checkbox_firm_data\",\n    onChange: () => handleChange('companyDataCheck', !state[0].companyDataCheck),\n    checked: state[0].companyDataCheck\n  }), __jsx(\"label\", {\n    htmlFor: \"checkbox_firm_data\"\n  }), __jsx(\"label\", {\n    htmlFor: \"checkbox_firm_data\"\n  }, translate.checkcompanydata[lang])), __jsx(AnimateHeight, {\n    duration: 500,\n    height: state[0].companyDataCheck ? 'auto' : 0\n  }, __jsx(Corporate, {\n    state: companyData[0],\n    setState: companyData[1]\n  })), __jsx(\"hr\", null), __jsx(\"div\", {\n    className: \"form_column\"\n  }, __jsx(\"div\", null, __jsx(\"button\", {\n    className: \"tm-button tm-bare-button\",\n    onClick: () => onLogout()\n  }, translate.logOut[lang])), __jsx(\"div\", {\n    className: \"uk-text-right\"\n  }, __jsx(\"button\", {\n    className: \"tm-button tm-black-button\",\n    onClick: e => onSave()\n  }, translate.save[lang]))))), __jsx(\"div\", {\n    className: \"basket-right-panel\"\n  }, __jsx(\"div\", {\n    className: \"basket-right-content\"\n  }, __jsx(\"div\", {\n    className: \"last_order_wrap tm-total-end\"\n  }, __jsx(\"table\", {\n    className: \"uk-table uk-table-small uk-table-divider\"\n  }, __jsx(\"thead\", null, __jsx(\"tr\", null, __jsx(\"th\", {\n    colSpan: \"2\"\n  }, translate.orderHistory[lang]))), __jsx(\"tbody\", null, (orders === null || orders === void 0 ? void 0 : orders.length) ? orders.map(item => __jsx(\"tr\", {\n    key: item._id\n  }, __jsx(\"td\", null, translate.orderNumber[lang], \" \", item.idOrder), __jsx(\"td\", {\n    className: \"uk-text-right\"\n  }, item.sum, \" \", ' ' + currency))) : __jsx(\"tr\", null, __jsx(\"td\", null, translate.noOrder[lang]), __jsx(\"td\", {\n    className: \"uk-text-right\"\n  }))))))));\n};\n\nexport default User;","map":null,"metadata":{},"sourceType":"module"}