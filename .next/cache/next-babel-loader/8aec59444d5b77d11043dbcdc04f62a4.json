{"ast":null,"code":"import React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useState, useEffect, useContext } from 'react';\nimport { AxiosAPI } from '../../../restClient';\nimport { DataStateContext } from '../../../context/dataStateContext';\nimport translate from '../../../data/staticTranslate';\nimport Page from '../../../layout/Page';\nimport { useRouter } from 'next/router';\nimport Head from '../../../components/Head';\nimport Body from '../../../components/Body';\nimport Checkout from '../../../components/Checkout';\nimport Total from '../../../components/Total';\nimport TotalEnd from '../../../components/TotalEnd';\nimport AcceptInfo from '../../../components/AcceptInfo';\nimport ButtonsSubmit from '../../../components/ButtonsSubmit';\nimport validationForm from '../../../functions/validationForm';\nimport sumTotal from '../../../functions/sumTotal';\nimport localize from '../../../data/localize';\n\nconst Basket = () => {\n  const router = useRouter();\n  const {\n    lang,\n    currency\n  } = localize(router.locale);\n  const {\n    dataContextState,\n    dataContextDispatch\n  } = useContext(DataStateContext);\n  const {\n    0: sum,\n    1: setSum\n  } = useState(0);\n  const {\n    0: sumBefore,\n    1: setSumBefore\n  } = useState(0);\n  const {\n    0: sale,\n    1: setSale\n  } = useState(0);\n  const {\n    0: basket\n  } = useState(dataContextState.basket);\n  const {\n    0: user,\n    1: setUser\n  } = useState(dataContextState.user);\n  const state = useState({\n    email: (user === null || user === void 0 ? void 0 : user.email) || '',\n    phone: (user === null || user === void 0 ? void 0 : user.phone) || '',\n    name: (user === null || user === void 0 ? void 0 : user.name) || '',\n    surname: (user === null || user === void 0 ? void 0 : user.surname) || '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: (user === null || user === void 0 ? void 0 : user.city) || '',\n    address: (user === null || user === void 0 ? void 0 : user.address) || '',\n    code: (user === null || user === void 0 ? void 0 : user.code) || '',\n    anotherAddressCheck: false,\n    companyDataCheck: false,\n    registrationCheck: false,\n    noteCheck: false\n  });\n  const anotherAdress = useState({\n    email: '',\n    phone: '',\n    name: '',\n    surname: '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: '',\n    address: '',\n    code: ''\n  });\n  const companyData = useState({\n    companyName: '',\n    ico: '',\n    dic: ''\n  });\n  const password = useState('');\n  const note = useState('');\n  const deliveryMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n  const paymentMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n  const {\n    0: error,\n    1: setError\n  } = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false,\n    delivery: false,\n    payment: false\n  });\n  const {\n    0: errorAnother,\n    1: setErrorAnother\n  } = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false\n  });\n  useEffect(() => {\n    setUser(dataContextState.user);\n    state[1](_objectSpread(_objectSpread({}, state[0]), dataContextState.user));\n  }, [dataContextState.user]);\n  useEffect(() => {\n    sumTotal(0, 0, basket, setSumBefore, setSale, setSum, lang);\n  }, []);\n  useEffect(() => {\n    sumTotal(deliveryMethod[0].price, paymentMethod[0].price, basket, setSumBefore, setSale, setSum, lang);\n  }, [deliveryMethod, paymentMethod]);\n\n  const onBlur = type => {\n    if (validationForm(type, state[0], error, setError)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const sendOrder = async () => {\n    if (!state[0].address.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        address: true\n      }));\n      return;\n    } else if (!state[0].city.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        city: true\n      }));\n      return;\n    } else if (!state[0].surname.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        surname: true\n      }));\n      return;\n    } else if (!state[0].name.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        name: true\n      }));\n      return;\n    } else if (!state[0].phone.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        phone: true\n      }));\n      return;\n    } else if (!state[0].code.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        code: true\n      }));\n      return;\n    }\n\n    if (onBlur('email')) return;\n\n    if (!deliveryMethod[0].value.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        delivery: true\n      }));\n      return;\n    }\n\n    if (!paymentMethod[0].value.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        payment: true\n      }));\n      return;\n    }\n\n    if (!basket.length) {\n      window.location.href = '/';\n      return;\n    }\n\n    const dataOrder = {\n      basket,\n      sum,\n      status: 'PENDING',\n      user: _objectSpread(_objectSpread({}, state[0]), {}, {\n        anotherAdress: anotherAdress[0],\n        companyData: companyData[0],\n        password: password[0]\n      }),\n      delivery: deliveryMethod[0],\n      payment: paymentMethod[0],\n      note: note[0],\n      currency: currency\n    };\n\n    if (state[0].registrationCheck) {\n      AxiosAPI.post(`${process.env.REACT_APP_API}/user`, {\n        data: dataOrder.user,\n        type: 'create'\n      }).then(res => dataContextDispatch({\n        state: res.data.data,\n        type: 'user'\n      }));\n    }\n\n    await AxiosAPI.post(`${process.env.REACT_APP_API}/order`, dataOrder).then(res => {\n      if (dataOrder.payment.payOnline) {\n        window.location.href = decodeURIComponent(res.data.data.redirect);\n      } else {\n        window.location.href = `/thank-you?refId=${res.data.data.idOrder}&dobirka=true`;\n      }\n    });\n  };\n\n  return __jsx(Page, {\n    className: \"basket\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content-wrap\"\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content\"\n  }, __jsx(Head, null), __jsx(Checkout, {\n    state: state,\n    error: error,\n    setError: setError,\n    user: user,\n    anotherAdress: anotherAdress,\n    companyData: companyData,\n    password: password,\n    note: note,\n    deliveryMethod: deliveryMethod,\n    errorAnother: errorAnother,\n    setErrorAnother: setErrorAnother,\n    paymentMethod: paymentMethod,\n    sumBefore: sumBefore,\n    onBlur: onBlur\n  }))), __jsx(\"div\", {\n    className: \"basket-right-panel\"\n  }, __jsx(\"div\", {\n    className: \"basket-right-content\"\n  }, __jsx(TotalEnd, {\n    sum: sum,\n    basket: basket,\n    sale: sale,\n    sumBefore: sumBefore,\n    delivery: deliveryMethod[0].price,\n    payment: paymentMethod[0].price\n  }), __jsx(\"div\", null, __jsx(\"p\", null, translate.infovat[lang]), __jsx(AcceptInfo, null)), __jsx(\"div\", {\n    className: \"tm-basket-footer tm-footer-single total-end-footer\"\n  }, Object.values(error).indexOf(true) >= 0 && __jsx(\"div\", {\n    className: \"uk-alert-danger uk-width-1-1 uk-text-center\",\n    \"uk-alert\": \"\"\n  }, __jsx(\"p\", null, translate.errorSendOrder[lang])), __jsx(ButtonsSubmit, {\n    sendOrder: sendOrder\n  })))));\n};\n\nexport default Basket;","map":null,"metadata":{},"sourceType":"module"}