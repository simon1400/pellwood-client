{"ast":null,"code":"import _regeneratorRuntime from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport { useState, useEffect } from 'react';\nimport { modal, util } from 'uikit';\nimport Page from '../../layout/Page';\nimport RandomArticles from '../../components/RandomArticles';\nimport Cart from '../../components/Cart';\nimport SubMenu from '../../components/SubMenu';\nimport sanityClient from \"../../lib/sanity.js\";\nimport ModalFilter from '../../components/ModalFilter';\nimport translate from '../../data/staticTranslate';\n\nvar Catalog = function Catalog(_ref) {\n  var _settings$metaCatalog, _settings$metaCatalog2;\n\n  var category = _ref.category,\n      settings = _ref.settings,\n      articleFirst = _ref.articleFirst,\n      articleSeccond = _ref.articleSeccond,\n      lang = _ref.lang,\n      currency = _ref.currency;\n\n  var _useState = useState([]),\n      product = _useState[0],\n      setProduct = _useState[1];\n\n  var _useState2 = useState(false),\n      filtered = _useState2[0],\n      setFiltered = _useState2[1];\n\n  var _useState3 = useState(''),\n      resetFilter = _useState3[0];\n\n  var _useState4 = useState(''),\n      search = _useState4[0],\n      setSearch = _useState4[1];\n\n  var _useState5 = useState(\"*[_type == \\\"product\\\"].\".concat(lang)),\n      urlProduct = _useState5[0],\n      setUrlProduct = _useState5[1];\n\n  var _useState6 = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  }),\n      stateRange = _useState6[0],\n      setStateRange = _useState6[1];\n\n  var _useState7 = useState({\n    length: {\n      min: 0,\n      max: 45\n    },\n    diameter: {\n      min: 0,\n      max: 45\n    }\n  }),\n      rangeNumber = _useState7[0],\n      setRangeNumber = _useState7[1];\n\n  useEffect(function () {\n    sanityClient.fetch(\"\".concat(urlProduct, \" | order(sort asc, title asc)\")).then(function (data) {\n      var filteredProduct = data.filter(function (item) {\n        return item === null || item === void 0 ? void 0 : item.title;\n      });\n\n      if (lang === 'en') {\n        filteredProduct.map(function (item) {\n          var _item$variants;\n\n          if (typeof item.price === 'string') {\n            item.price.replace(/,/g, '.');\n          } else if ((_item$variants = item.variants) === null || _item$variants === void 0 ? void 0 : _item$variants.length) {\n            item.variants = item.variants.map(function (variant) {\n              variant.price = variant.price.replace(/,/g, '.');\n              return variant;\n            });\n          }\n        });\n      }\n\n      setProduct(filteredProduct);\n      var lengthNumbers = [],\n          diameterNumbers = [];\n      var length = undefined,\n          diameter = undefined;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i;\n\n        if ((_filteredProduct$i = filteredProduct[i]) === null || _filteredProduct$i === void 0 ? void 0 : _filteredProduct$i.parametrs) {\n          var _filteredProduct$i2, _filteredProduct$i3;\n\n          length = (_filteredProduct$i2 = filteredProduct[i]) === null || _filteredProduct$i2 === void 0 ? void 0 : _filteredProduct$i2.parametrs.find(function (o) {\n            return o.title === 'Délka' || o.title === 'Length';\n          });\n          diameter = (_filteredProduct$i3 = filteredProduct[i]) === null || _filteredProduct$i3 === void 0 ? void 0 : _filteredProduct$i3.parametrs.find(function (o) {\n            return o.title === 'Průměr' || o.title === 'Diameter';\n          });\n\n          if (length) {\n            lengthNumbers.push(+length.value.substr(0, length.value.length - 3).split(',').join('.'));\n          }\n\n          if (diameter) {\n            diameterNumbers.push(+diameter.value.substr(0, diameter.value.length - 3).split(',').join('.'));\n          }\n        }\n      }\n\n      var rangeNum = {\n        length: {\n          min: Math.min.apply(Math, lengthNumbers),\n          max: Math.max.apply(Math, lengthNumbers)\n        },\n        diameter: {\n          min: Math.min.apply(Math, diameterNumbers),\n          max: Math.max.apply(Math, diameterNumbers)\n        }\n      };\n      setRangeNumber(rangeNum);\n      setStateRange(rangeNum);\n    });\n  }, []);\n\n  var closeModal = function closeModal() {\n    modal(util.find('#modal-filter')).hide();\n  };\n\n  var handleFilter = function handleFilter(e) {\n    e.preventDefault();\n    var newUrlProduct = \"*[_type == \\\"product\\\" \".concat(!!search.length ? '&& ' + lang + '.title match \"' + search.split(/[,-]+/).join(' ') + '*\"' : '', \"].\").concat(lang);\n    setUrlProduct(newUrlProduct);\n    var searchQuery = \"\".concat(newUrlProduct, \" | order(sort asc, title asc)\");\n    sanityClient.fetch(searchQuery).then(function (data) {\n      var filteredProduct = data.filter(function (item) {\n        return item === null || item === void 0 ? void 0 : item.title;\n      });\n      var filteredProdParameters = [];\n      var length = undefined,\n          diameter = undefined,\n          lengthNum = 0,\n          diameterNum = 0;\n\n      for (var i = 0; i < filteredProduct.length; i++) {\n        var _filteredProduct$i4;\n\n        if ((_filteredProduct$i4 = filteredProduct[i]) === null || _filteredProduct$i4 === void 0 ? void 0 : _filteredProduct$i4.parametrs) {\n          var _filteredProduct$i5, _filteredProduct$i6;\n\n          length = (_filteredProduct$i5 = filteredProduct[i]) === null || _filteredProduct$i5 === void 0 ? void 0 : _filteredProduct$i5.parametrs.find(function (o) {\n            return o.title === 'Délka' || o.title === 'Length';\n          });\n          diameter = (_filteredProduct$i6 = filteredProduct[i]) === null || _filteredProduct$i6 === void 0 ? void 0 : _filteredProduct$i6.parametrs.find(function (o) {\n            return o.title === 'Průměr' || o.title === 'Diameter';\n          });\n\n          if (length || diameter) {\n            if (length) {\n              lengthNum = +length.value.substr(0, length.value.length - 3).split(',').join('.');\n            }\n\n            if (diameter) {\n              diameterNum = +diameter.value.substr(0, diameter.value.length - 3).split(',').join('.');\n            }\n\n            if (lengthNum <= stateRange.length.max && lengthNum >= stateRange.length.min && diameterNum <= stateRange.diameter.max && diameterNum >= stateRange.diameter.min) {\n              filteredProdParameters.push(filteredProduct[i]);\n            }\n          }\n        }\n      }\n\n      setProduct(filteredProdParameters);\n    });\n    closeModal();\n    setFiltered(true);\n  };\n\n  var cancelFilter = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              e.preventDefault();\n              setFiltered(false);\n              setStateRange(rangeNumber);\n              setSearch('');\n              setUrlProduct(\"*[_type == \\\"product\\\"].\".concat(lang));\n              _context.next = 7;\n              return sanityClient.fetch(\"*[_type == \\\"product\\\"].\".concat(lang, \" | order(sort asc) | order(title asc)\"));\n\n            case 7:\n              data = _context.sent;\n              setProduct(data);\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function cancelFilter(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(Page, {\n    id: \"catalog\",\n    title: (_settings$metaCatalog = settings.metaCatalog) === null || _settings$metaCatalog === void 0 ? void 0 : _settings$metaCatalog.title,\n    description: (_settings$metaCatalog2 = settings.metaCatalog) === null || _settings$metaCatalog2 === void 0 ? void 0 : _settings$metaCatalog2.description\n  }, (settings === null || settings === void 0 ? void 0 : settings.titleCategory) && __jsx(\"section\", {\n    className: \"head_category\"\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"div\", {\n    className: \"content_head_wrap\"\n  }, __jsx(\"h1\", null, settings.titleCategory), __jsx(\"p\", null, settings.descriptionCategory)))), __jsx(\"section\", {\n    className: \"category grey\",\n    id: \"catalog-short\",\n    \"uk-filter\": \"target: .js-filter\"\n  }, __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"div\", {\n    className: \"category_menu uk-flex uk-flex-between uk-flex-middle uk-flex-wrap\"\n  }, __jsx(\"div\", {\n    className: \"uk-flex uk-flex-middle uk-width-1-1 uk-flex-between uk-flex-wrap\"\n  }, __jsx(\"div\", {\n    className: \"filter-controls-wrap\"\n  }, __jsx(\"a\", {\n    className: \"tm-button tm-black-button\",\n    href: \"#modal-filter\",\n    \"uk-toggle\": \"\"\n  }, translate.searchAndFilter[lang]), filtered && __jsx(\"button\", {\n    className: \"cancel-filtered tm-button tm-button-text\",\n    onClick: function onClick(e) {\n      return cancelFilter(e);\n    }\n  }, __jsx(\"img\", {\n    src: \"/assets/times.svg\",\n    alt: \"Cancel filter\",\n    \"uk-svg\": \"\"\n  }), \"Zru\\u0161it v\\u0161echny filtry\")), __jsx(SubMenu, {\n    data: category\n  })))), __jsx(\"div\", {\n    className: \"uk-container uk-container-expand\"\n  }, __jsx(\"ul\", {\n    className: \"js-filter uk-grid uk-child-width-1-1 uk-child-width-1-3@m uk-child-width-1-2@s\".concat(resetFilter ? ' show-all' : ''),\n    \"uk-grid\": \"\"\n  }, !!product.length && product.map(function (item, index) {\n    return __jsx(Cart, {\n      item: item,\n      key: index,\n      lang: lang,\n      currency: currency\n    });\n  })))), __jsx(RandomArticles, {\n    lang: lang,\n    articleFirst: articleFirst,\n    articleSeccond: articleSeccond\n  }), __jsx(ModalFilter, {\n    setSearch: setSearch,\n    search: search,\n    lang: lang,\n    closeModal: closeModal,\n    setStateRange: setStateRange,\n    handleFilter: handleFilter,\n    rangeNumber: rangeNumber,\n    stateRange: stateRange\n  }));\n};\n\nexport var __N_SSP = true;\nexport default Catalog;","map":null,"metadata":{},"sourceType":"module"}