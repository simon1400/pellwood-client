{"ast":null,"code":"import _defineProperty from \"/Users/dmytropechunka/Desktop/work/pellwood/client/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nvar _jsxFileName = \"/Users/dmytropechunka/Desktop/work/pellwood/client/pages/basket/index.js\",\n    _s = $RefreshSig$();\n\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useState, useEffect, useContext } from 'react';\nimport { AxiosAPI } from '../../restClient';\nimport { DataStateContext } from '../../context/dataStateContext';\nimport translate from '../../data/staticTranslate';\nimport { useRouter } from 'next/router';\nimport Head from '../../components/Head';\nimport Body from '../../components/Body';\nimport Checkout from '../../components/Checkout';\nimport Total from '../../components/Total';\nimport TotalEnd from '../../components/TotalEnd';\nimport AcceptInfo from '../../components/AcceptInfo';\nimport ButtonsSubmit from '../../components/ButtonsSubmit';\nimport validationForm from '../../functions/validationForm';\nimport localize from '../../data/localize';\n\nconst Basket = () => {\n  _s();\n\n  const router = useRouter();\n  const {\n    lang,\n    currency\n  } = localize(router.locale);\n  const {\n    dataContextState,\n    dataContextDispatch\n  } = useContext(DataStateContext);\n  const {\n    0: sum,\n    1: setSum\n  } = useState(0);\n  const {\n    0: sumBefore,\n    1: setSumBefore\n  } = useState(0);\n  const {\n    0: sale,\n    1: setSale\n  } = useState(0);\n  const {\n    0: basket,\n    1: setBasket\n  } = useState(dataContextState.basket);\n  const {\n    0: user,\n    1: setUser\n  } = useState(dataContextState.user);\n  const state = useState({\n    email: (user === null || user === void 0 ? void 0 : user.email) || '',\n    phone: (user === null || user === void 0 ? void 0 : user.phone) || '',\n    name: (user === null || user === void 0 ? void 0 : user.name) || '',\n    surname: (user === null || user === void 0 ? void 0 : user.surname) || '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: (user === null || user === void 0 ? void 0 : user.city) || '',\n    address: (user === null || user === void 0 ? void 0 : user.address) || '',\n    code: (user === null || user === void 0 ? void 0 : user.code) || '',\n    anotherAddressCheck: false,\n    companyDataCheck: false,\n    registrationCheck: false,\n    noteCheck: false\n  });\n  const anotherAdress = useState({\n    email: '',\n    phone: '',\n    name: '',\n    surname: '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: '',\n    address: '',\n    code: ''\n  });\n  const companyData = useState({\n    companyName: '',\n    ico: '',\n    dic: ''\n  });\n  const password = useState('');\n  const note = useState('');\n  const deliveryMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n  const paymentMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  });\n  const {\n    0: error,\n    1: setError\n  } = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false,\n    delivery: false,\n    payment: false\n  });\n  const {\n    0: errorAnother,\n    1: setErrorAnother\n  } = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false\n  });\n  useEffect(() => {\n    if (!(basket === null || basket === void 0 ? void 0 : basket.length)) {\n      window.location.href = '/';\n    }\n  }, [basket]);\n  useEffect(() => {\n    setUser(dataContextState.user);\n    state[1](_objectSpread(_objectSpread({}, state[0]), dataContextState.user));\n  }, [dataContextState.user]);\n  useEffect(() => {\n    sumTotal(0, 0);\n  }, []);\n  useEffect(() => {\n    sumTotal(deliveryMethod[0].price, paymentMethod[0].price);\n  }, [deliveryMethod, paymentMethod]);\n\n  const sumTotal = (delivery, payment) => {\n    var sumAll = 0,\n        sumItem = 0;\n    var newBasket = basket;\n    newBasket.map((item, index) => {\n      if (item.variantPrice instanceof String) sumItem = +item.variantPrice * item.countVariant;else sumItem = item.variantPrice * item.countVariant;\n      sumAll = +sumItem + sumAll;\n    });\n    let sumItemsBefore = sumAll;\n    setSumBefore(sumItemsBefore);\n    if (lang === 'en' && sumAll > 150) setSale((Math.round(sumAll * 0.05 * 100) / 100).toFixed(2));else if (lang === 'cz' && sumAll > 2000) setSale(Math.round(sumAll * 0.05));\n\n    if (lang === 'cz' && sumAll > 2000 || lang === 'en' && sumAll > 150) {\n      setSumBefore(Math.round(sumAll - sumAll * 0.05));\n      sumAll = sumAll - sumAll * 0.05;\n    }\n\n    if (lang === 'en' && sumAll <= 150 || lang === 'cz' && sumAll <= 2000) setSale(0);\n\n    if (delivery || payment) {\n      if (delivery !== translate.free[lang] && (lang === 'en' && sumAll <= 100 || lang === 'cz' && sumAll <= 1500)) sumAll = +sumAll + +delivery.split(' ')[0];\n      if (payment !== translate.free[lang]) sumAll = +sumAll + +payment.split(' ')[0];\n    }\n\n    if (lang === 'en') setSum((Math.round(sumAll * 100) / 100).toFixed(2));else setSum(Math.round(sumAll));\n  };\n\n  const onBlur = type => {\n    if (validationForm(type, state[0], error, setError)) {\n      return true;\n    }\n\n    return false;\n  };\n\n  const sendOrder = async () => {\n    if (!state[0].address.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        address: true\n      }));\n      return;\n    } else if (!state[0].city.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        city: true\n      }));\n      return;\n    } else if (!state[0].surname.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        surname: true\n      }));\n      return;\n    } else if (!state[0].name.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        name: true\n      }));\n      return;\n    } else if (!state[0].phone.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        phone: true\n      }));\n      return;\n    } else if (!state[0].code.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        code: true\n      }));\n      return;\n    }\n\n    if (onBlur('email')) return;\n\n    if (!deliveryMethod[0].value.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        delivery: true\n      }));\n      return;\n    }\n\n    if (!paymentMethod[0].value.length) {\n      setError(_objectSpread(_objectSpread({}, error), {}, {\n        payment: true\n      }));\n      return;\n    }\n\n    if (!basket.length) {\n      window.location.href = '/';\n      return;\n    }\n\n    const dataOrder = {\n      basket,\n      sum,\n      status: 'PENDING',\n      user: _objectSpread(_objectSpread({}, state[0]), {}, {\n        anotherAdress: anotherAdress[0],\n        companyData: companyData[0],\n        password: password[0]\n      }),\n      delivery: deliveryMethod[0],\n      payment: paymentMethod[0],\n      note: note[0],\n      currency: currency\n    };\n\n    if (state[0].registrationCheck) {\n      AxiosAPI.post(`${process.env.REACT_APP_API}/user`, {\n        data: dataOrder.user,\n        type: 'create'\n      }).then(res => dataContextDispatch({\n        state: res.data.data,\n        type: 'user'\n      }));\n    }\n\n    await AxiosAPI.post(`${process.env.REACT_APP_API}/order`, dataOrder).then(res => {\n      if (dataOrder.payment.payOnline) {\n        window.location.href = decodeURIComponent(res.data.data.redirect);\n      } else {\n        window.location.href = `/thank-you?refId=${res.data.data.idOrder}&dobirka=true`;\n      }\n    });\n  };\n\n  return __jsx(\"main\", {\n    className: \"basket\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content-wrap\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"tm-basket-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 9\n    }\n  }, __jsx(Head, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 11\n    }\n  }), __jsx(Body, {\n    setSum: setSum,\n    sum: sum,\n    basket: basket,\n    setBasket: setBasket,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 11\n    }\n  }), __jsx(Checkout, {\n    state: state,\n    error: error,\n    setError: setError,\n    user: user,\n    anotherAdress: anotherAdress,\n    companyData: companyData,\n    password: password,\n    note: note,\n    deliveryMethod: deliveryMethod,\n    errorAnother: errorAnother,\n    setErrorAnother: setErrorAnother,\n    paymentMethod: paymentMethod,\n    sumBefore: sumBefore,\n    onBlur: onBlur,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 11\n    }\n  }))), __jsx(\"div\", {\n    className: \"basket-right-panel\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 7\n    }\n  }, __jsx(\"div\", {\n    className: \"basket-right-content\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 9\n    }\n  }, __jsx(Total, {\n    sum: sumBefore,\n    sale: sale,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 11\n    }\n  }), __jsx(TotalEnd, {\n    sum: sum,\n    basket: basket,\n    sale: sale,\n    sumBefore: sumBefore,\n    delivery: deliveryMethod[0].price,\n    payment: paymentMethod[0].price,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 11\n    }\n  }), __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 11\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  }, translate.infovat[lang]), __jsx(AcceptInfo, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 13\n    }\n  })), __jsx(\"div\", {\n    className: \"tm-basket-footer tm-footer-single total-end-footer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 249,\n      columnNumber: 11\n    }\n  }, Object.values(error).indexOf(true) >= 0 && __jsx(\"div\", {\n    className: \"uk-alert-danger uk-width-1-1 uk-text-center\",\n    \"uk-alert\": \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 57\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 130\n    }\n  }, translate.errorSendOrder[lang])), __jsx(ButtonsSubmit, {\n    sendOrder: sendOrder,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 13\n    }\n  })))));\n};\n\n_s(Basket, \"bI+9obQhDOgQ+uiUAI+JREysRr4=\", false, function () {\n  return [useRouter];\n});\n\n_c = Basket;\nexport default _c2 = withRouter(Basket);\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"Basket\");\n$RefreshReg$(_c2, \"%default%\");","map":{"version":3,"sources":["/Users/dmytropechunka/Desktop/work/pellwood/client/pages/basket/index.js"],"names":["useState","useEffect","useContext","AxiosAPI","DataStateContext","translate","useRouter","Head","Body","Checkout","Total","TotalEnd","AcceptInfo","ButtonsSubmit","validationForm","localize","Basket","router","lang","currency","locale","dataContextState","dataContextDispatch","sum","setSum","sumBefore","setSumBefore","sale","setSale","basket","setBasket","user","setUser","state","email","phone","name","surname","country","city","address","code","anotherAddressCheck","companyDataCheck","registrationCheck","noteCheck","anotherAdress","companyData","companyName","ico","dic","password","note","deliveryMethod","value","price","payOnline","paymentMethod","error","setError","delivery","payment","errorAnother","setErrorAnother","length","window","location","href","sumTotal","sumAll","sumItem","newBasket","map","item","index","variantPrice","String","countVariant","sumItemsBefore","Math","round","toFixed","free","split","onBlur","type","sendOrder","dataOrder","status","post","process","env","REACT_APP_API","data","then","res","decodeURIComponent","redirect","idOrder","infovat","Object","values","indexOf","errorSendOrder","withRouter"],"mappings":"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","sourcesContent":["import {useState, useEffect, useContext} from 'react';\nimport {AxiosAPI} from '../../restClient'\nimport { DataStateContext } from '../../context/dataStateContext'\nimport translate from '../../data/staticTranslate'\nimport { useRouter } from 'next/router'\nimport Head from '../../components/Head'\nimport Body from '../../components/Body'\nimport Checkout from '../../components/Checkout'\nimport Total from '../../components/Total'\nimport TotalEnd from '../../components/TotalEnd'\nimport AcceptInfo from '../../components/AcceptInfo'\nimport ButtonsSubmit from '../../components/ButtonsSubmit'\nimport validationForm from '../../functions/validationForm'\n\nimport localize from '../../data/localize'\n\nconst Basket = () => {\n\n  const router = useRouter()\n  const {lang, currency} = localize(router.locale)\n  const { dataContextState, dataContextDispatch } = useContext(DataStateContext)\n  const [sum, setSum] = useState(0)\n  const [sumBefore, setSumBefore] = useState(0)\n  const [sale, setSale] = useState(0)\n  const [basket, setBasket] = useState(dataContextState.basket)\n  const [user, setUser] = useState(dataContextState.user)\n\n  const state = useState({\n    email: user?.email || '',\n    phone: user?.phone || '',\n    name: user?.name || '',\n    surname: user?.surname || '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: user?.city || '',\n    address: user?.address || '',\n    code: user?.code || '',\n    anotherAddressCheck: false,\n    companyDataCheck: false,\n    registrationCheck: false,\n    noteCheck: false\n  })\n\n  const anotherAdress = useState({\n    email: '',\n    phone: '',\n    name: '',\n    surname: '',\n    country: lang === 'cz' ? 'cz' : 'de',\n    city: '',\n    address: '',\n    code: ''\n  })\n\n  const companyData = useState({\n    companyName: '',\n    ico: '',\n    dic: '',\n  })\n\n  const password = useState('')\n  const note = useState('')\n\n\n  const deliveryMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  })\n  const paymentMethod = useState({\n    value: '',\n    price: '',\n    payOnline: false\n  })\n\n  const [error, setError] = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false,\n    delivery: false,\n    payment: false\n  })\n  const [errorAnother, setErrorAnother] = useState({\n    email: false,\n    phone: false,\n    name: false,\n    surname: false,\n    city: false,\n    address: false,\n    code: false\n  })\n\n  useEffect(() => {\n    if(!basket?.length){\n      window.location.href = '/'\n    }\n  }, [basket])\n\n  useEffect(() => {\n    setUser(dataContextState.user)\n    state[1]({...state[0], ...dataContextState.user})\n  }, [dataContextState.user])\n\n  useEffect(() => {\n    sumTotal(0, 0)\n  }, [])\n\n  useEffect(() => {\n    sumTotal(deliveryMethod[0].price, paymentMethod[0].price)\n  }, [deliveryMethod, paymentMethod])\n\n  const sumTotal = (delivery, payment) => {\n    var sumAll = 0, sumItem = 0;\n    var newBasket = basket\n    newBasket.map((item, index) => {\n\n      if(item.variantPrice instanceof String)sumItem = +item.variantPrice * item.countVariant\n      else sumItem = item.variantPrice * item.countVariant\n\n      sumAll = +sumItem + sumAll\n    })\n\n    let sumItemsBefore = sumAll\n    setSumBefore(sumItemsBefore)\n\n    if(lang === 'en' && sumAll > 150) setSale((Math.round(sumAll * 0.05 * 100) / 100).toFixed(2))\n    else if(lang === 'cz' && sumAll > 2000) setSale(Math.round(sumAll * 0.05))\n\n    if(lang === 'cz' && sumAll > 2000 || lang === 'en' && sumAll > 150){\n      setSumBefore(Math.round(sumAll - (sumAll * 0.05)))\n      sumAll = sumAll - (sumAll * 0.05)\n    }\n\n    if(lang === 'en' && sumAll <= 150 || lang === 'cz' && sumAll <= 2000) setSale(0)\n\n    if(delivery || payment){\n      if(delivery !== translate.free[lang] && ((lang === 'en' && sumAll <= 100) || (lang === 'cz' && sumAll <= 1500))) sumAll = +sumAll + +delivery.split(' ')[0]\n      if(payment !== translate.free[lang]) sumAll = +sumAll + +payment.split(' ')[0]\n    }\n\n    if(lang === 'en') setSum((Math.round(sumAll * 100) / 100).toFixed(2))\n    else setSum(Math.round(sumAll))\n  }\n\n  const onBlur = (type) => {\n    if(validationForm(type, state[0], error, setError)) {\n      return true\n    }\n    return false\n  }\n\n\n  const sendOrder = async () => {\n\n    if(!state[0].address.length) {setError({...error, address: true}); return;}\n    else if(!state[0].city.length) {setError({...error, city: true}); return;}\n    else if(!state[0].surname.length) {setError({...error, surname: true}); return;}\n    else if(!state[0].name.length) {setError({...error, name: true}); return;}\n    else if(!state[0].phone.length) {setError({...error, phone: true}); return;}\n    else if(!state[0].code.length) {setError({...error, code: true}); return;}\n\n    if(onBlur('email')) return\n\n    if(!deliveryMethod[0].value.length){ setError({ ...error, delivery: true }); return;}\n    if(!paymentMethod[0].value.length){ setError({ ...error, payment: true }); return;}\n\n    if(!basket.length){\n      window.location.href = '/'\n      return\n    }\n\n    const dataOrder = {\n      basket,\n      sum,\n      status: 'PENDING',\n      user: {\n        ...state[0],\n        anotherAdress: anotherAdress[0],\n        companyData: companyData[0],\n        password: password[0]\n      },\n      delivery: deliveryMethod[0],\n      payment: paymentMethod[0],\n      note: note[0],\n      currency: currency\n    }\n\n    if(state[0].registrationCheck){\n      AxiosAPI.post(`${process.env.REACT_APP_API}/user`, {data: dataOrder.user, type: 'create'}).then(res =>\n        dataContextDispatch({ state: res.data.data, type: 'user' })\n      )\n    }\n\n    await AxiosAPI.post(`${process.env.REACT_APP_API}/order`, dataOrder).then(res => {\n      if(dataOrder.payment.payOnline){\n        window.location.href = decodeURIComponent(res.data.data.redirect)\n      }else{\n        window.location.href = `/thank-you?refId=${res.data.data.idOrder}&dobirka=true`\n      }\n    })\n\n  }\n\n\n  return (\n    <main className=\"basket\">\n      <div className=\"tm-basket-content-wrap\">\n        <div className=\"tm-basket-content\">\n          <Head />\n          <Body\n            setSum={setSum}\n            sum={sum}\n            basket={basket}\n            setBasket={setBasket} />\n          <Checkout\n            state={state}\n            error={error}\n            setError={setError}\n            user={user}\n            anotherAdress={anotherAdress}\n            companyData={companyData}\n            password={password}\n            note={note}\n            deliveryMethod={deliveryMethod}\n            errorAnother={errorAnother}\n            setErrorAnother={setErrorAnother}\n            paymentMethod={paymentMethod}\n            sumBefore={sumBefore}\n            onBlur={onBlur} />\n        </div>\n      </div>\n      <div className=\"basket-right-panel\">\n        <div className=\"basket-right-content\">\n          <Total sum={sumBefore} sale={sale} />\n          <TotalEnd\n            sum={sum}\n            basket={basket}\n            sale={sale}\n            sumBefore={sumBefore}\n            delivery={deliveryMethod[0].price}\n            payment={paymentMethod[0].price} />\n          <div>\n            <p>{translate.infovat[lang]}</p>\n            <AcceptInfo />\n          </div>\n          <div className=\"tm-basket-footer tm-footer-single total-end-footer\">\n            {Object.values(error).indexOf(true) >= 0 && <div className=\"uk-alert-danger uk-width-1-1 uk-text-center\" uk-alert=\"\"><p>{translate.errorSendOrder[lang]}</p></div>}\n            <ButtonsSubmit sendOrder={sendOrder} />\n          </div>\n        </div>\n      </div>\n    </main>\n  )\n}\nexport default withRouter(Basket)\n"]},"metadata":{},"sourceType":"module"}